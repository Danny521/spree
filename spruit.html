<head>
  <title>Spark Jobs</title>
  <script src="client/js/moment.js" type="text/javascript" />
</head>

<body>
<div class="navbar navbar-static-top">

</div>

</body>

<template name="appsPage">
  <div class="container-fluid">
    <h3>Spark Applications</h3>
    <table>
      <tbody>
        <tr>
          <th>App ID</th>
          <th>App Name</th>
          <th>Started</th>
          <th>Completed</th>
          <th>Duration</th>
          <th>User</th>
        </tr>
        {{#each applications}}
          <tr>
            <td><a href="/a/{{id}}">{{id}}</a></td>
            <td>{{name}}</td>
            <td>{{formatDateTime time.start}}</td>
            <td>{{formatDateTime time.end}}</td>
            <td>{{formatDuration time.start time.end}}</td>
            <td>{{user}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</template>

<template name="jobsPage">
  {{log this}}
  <div class="container-fluid">
    <h3>Spark Jobs</h3>
    <div><strong>Total Duration:</strong> TODO</div>
    <div><strong>Scheduling Mode:</strong> TODO</div>
    <div><a href="#completed"><strong>Completed Jobs:</strong></a> TODO</div>

    <h4 id="completed">Completed Jobs</h4>
    <table>
      <tbody>
      <tr>
        <th>Job Id</th>
        <th>Description</th>
        <th>Submitted</th>
        <th>Duration</th>
        <th>Stages: Succeeded/Total</th>
        <th>Tasks (all stages): Succeeded/Total</th>
      </tr>
      {{#each jobs}}
      <tr class="{{rowClass this}}">
        <td>{{id}}</td>
        <td><a href="/a/{{appId}}/job/{{id}}">{{getJobName this}}</a></td>
        <td>{{formatDateTime time.start}}</td>
        <td>{{getJobDuration this}}</td>
        <td>{{> progressBar stageCounts}}</td>
        <td>{{> progressBar taskCounts}}</td>
      </tr>
      {{/each}}
      </tbody>
    </table>
  </div>
</template>

<template name="jobPage">
  {{log this}}
  <div class="container-fluid">
    <h3>Details for Job {{job.id}}</h3>
    <div><strong>Status:</strong> {{jobStatus job}}</div>
    <div>
      <strong><a href="#completed-stages">Completed Stages:</a></strong>
      {{#if job.stageCounts}}
        {{#with job.stageCounts}}
          {{completed this}}
          ({{succeeded}} succeeded, {{failed}} failed, {{running}} running)
        {{/with}}
      {{else}}
        0
      {{/if}}
    </div>
    <h4 id="completed-stages">Completed Stages ({{completed job.stageCounts}})</h4>
    <table>
      <tr>
        <th>Stage ID</th>
        <th>Description</th>
        <th>Submitted</th>
        <th>Duration</th>
        <th>Tasks: Suceeded/Total</th>
        <th>Input</th>
        <th>Output</th>
        <th>Shuffle Read</th>
        <th>Shuffle Write</th>
      </tr>
      {{#each stages}}
        {{> stageRow this}}
      {{/each}}
    </table>
  </div>
</template>

<template name="stageRow">
  <tr class="{{getClass this}}">
    <td>{{id}}</td>
    <td>{{name}}</td>
    <td>{{formatDateTime time.start}}</td>
    <td>{{formatDuration time.start time.end}}</td>
    <td>{{> progressBar taskCounts}}</td>
    <td>{{formatBytes metrics.inputMetrics.bytesRead}}</td>
    <td>{{formatBytes metrics.outputMetrics.bytesWritten}}</td>
    <td>{{shuffleRead metrics.shuffleReadMetrics}}</td>
    <td>{{formatBytes metrics.shuffleWriteMetrics.shuffleBytesWritten}}</td>
  </tr>
</template>

<template name="progressBar">
  <div class="progress">
    <span class="label">{{label this}}</span>
    <div class="bar bar-completed" style="width:{{completedPercentage this}}"></div>
    <div class="bar bar-running" style="width:{{runningPercentage this}}"></div>
  </div>
</template>
