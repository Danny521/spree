<head>
  <title>Spark Jobs</title>
  <script src="client/js/moment.js" type="text/javascript" />
</head>

<body>
<div class="navbar navbar-static-top">

</div>

</body>

<template name="jobsPage">
  <div class="container-fluid">
    <h3>Spark Jobs</h3>
    <div><strong>Total Duration:</strong> TODO</div>
    <div><strong>Scheduling Mode:</strong> TODO</div>
    <div><a href="#completed"><strong>Completed Jobs:</strong></a> TODO</div>

    <h4 id="completed">Completed Jobs</h4>
    <table>
      <tbody>
      <tr>
        <th>Job Id</th>
        <th>Description</th>
        <th>Submitted</th>
        <th>Duration</th>
        <th>Stages: Succeeded/Total</th>
        <th>Tasks (for all stages): Succeeded/Total</th>
      </tr>
      {{> jobRows}}
      </tbody>
    </table>
  </div>
</template>

<template name="jobRows">
  {{#with data}}
  {{#each jobs}}
  <tr class="{{rowClass this}}">
    <td>{{id}}</td>
    <td><a href="/job/{{id}}">{{getJobName this}}</a></td>
    <td>{{formatDateTime time.start}}</td>
    <td>{{getJobDuration this}}</td>
    <td>{{getSucceededStages this}}/{{stages.length}}</td>
    <td>
      {{taskCounts.succeeded}}/{{taskCounts.num}},
      ({{taskCounts.started}} started,
      {{#if taskCounts.failed}}{{taskCounts.failed}}{{else}}0{{/if}} failed)
    </td>
  </tr>
  {{/each}}
  {{/with}}
</template>

<template name="jobPage">
  {{log this}}
  <div class="container-fluid">
    <h3>Details for Job {{job.id}}</h3>
    <div><strong>Status:</strong> {{jobStatus job}}</div>
    <div>
      <strong><a href="#completed-stages">Completed Stages:</a></strong>
      {{numCompleteStages this}}
      ({{numSucceededStages this}} succeeded, {{numFailedStages this}} failed, {{numRunningStages this}} running)
    </div>
    <h4 id="completed-stages">Completed Stages ({{numCompleteStages this}})</h4>
    <table>
      <tr>
        <th>Stage ID</th>
        <th>Description</th>
        <th>Submitted</th>
        <th>Duration</th>
        <th>Tasks: Suceeded/Total</th>
        <th>Input</th>
        <th>Output</th>
        <th>Shuffle Read</th>
        <th>Shuffle Write</th>
      </tr>
      {{#each stages}}
        {{> stageRow this}}
      {{/each}}
    </table>
  </div>
</template>

<template name="stageRow">
  <tr>
    <td>{{id}}</td>
    <td>{{name}}</td>
    <td>{{formatDateTime time.start}}</td>
    <td>{{formatDuration time.start time.end}}</td>
    <td>{{taskCounts.succeeded}}/{{taskCounts.started}}</td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
</template>
