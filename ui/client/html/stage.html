
<template name="reactStagePage">
  <div>
    {{>React component=StagePage}}
  </div>
</template>

<template name="stagePage">
  {{>navbar}}
  {{setTitle this}}
  {{log this}}
  <div class="container-fluid">
    <h3>Details for Stage {{stageId}}, Attempt {{attemptId}}</h3>
    {{#with stageAttempt.metrics}}
      <div><strong>Total time across all tasks:</strong> {{formatTime ExecutorRunTime}}</div>

      {{#with InputMetrics}}
        {{#if BytesRead}}
        <div>
          <strong>Input Size / Records:</strong> {{formatBytes BytesRead}} / {{RecordsRead}} records
        </div>
        {{/if}}
      {{/with}}

      {{#with OutputMetrics}}
        {{#if BytesWritten}}
        <div>
          <strong>Output Size / Records:</strong> {{formatBytes BytesWritten}} / {{RecordsWritten}} records
        </div>
        {{/if}}
      {{/with}}

      {{#with ShuffleReadMetrics}}
        {{#if shuffleBytesRead this}}
        <div>
          <strong>Shuffle read:</strong> {{shuffleBytesReadStr this}} / {{TotalRecordsRead}} records
        </div>
        {{/if}}
      {{/with}}

      {{#with ShuffleWriteMetrics}}
        {{#if ShuffleBytesWritten}}
        <div>
          <strong>Shuffle write:</strong> {{formatBytes ShuffleBytesWritten}} / {{ShuffleRecordsWritten}} records
        </div>
        {{/if}}
      {{/with}}
    {{/with}}

    <!--{{> summaryStatsTable this}}-->
    <!--{{> executorTable this}}-->
    <div>
      {{>React component=SummaryMetricsTable stats=stats taskCounts=stageAttempt.taskCounts}}
    </div>
    <div>
      {{>React component=ExecutorsTable stageId=stageAttempt.stageId attemptId=stageAttempt.id}}
    </div>
    <div>
      {{>React component=TasksTable data=taskAttempts}}
    </div>
  </div>
</template>

<template name="summaryStatsTable">
  {{#with stage.taskCounts}}
    <h4>
      Summary Metrics for {{numCompletedTasks this}} Completed Tasks
      ({{num}} total,
        {{running}} active,
        {{#if failed}}{{failed}}{{else}}0{{/if}} failed,
        {{#if succeeded}}{{succeeded}}{{else}}0{{/if}} succeeded)
    </h4>
  {{/with}}
  {{>statsTable data=sorted columns=columns class="stats"}}
</template>

<template name='summaryStatsRow-min'>
  {{min}}
</template>

<template name='summaryStatsRow-25'>
  {{tf}}
</template>

<template name='summaryStatsRow-50'>
  {{median}}
</template>

<template name='summaryStatsRow-75'>
  {{sf}}
</template>

<template name='summaryStatsRow-max'>
  {{max}}
</template>

<template name="hostPort">
  {{host}}:{{port}}
</template>

<template name="executorTable">
  <h4>Aggregated Metrics by Executor</h4>
  {{>table data=sorted columns=columns}}
</template>

<template name="stageExecRow-address">
  {{>hostPort}}
</template>


<template name="tasksTable">
  <!--<h4>Tasks ({{numTasks}})</h4>-->
  <!--{{#with eTasks}}-->
  {{log "tasksTable: " this}}
  <!--{{#with taskAttempts}}-->
    <!--{{>reactTable data=sorted columns=columns}}-->
  <!--{{/with}}-->
  <!--{{else}}-->
    <!--{{>table columns=columns}}-->
  <!--{{/with}}-->
</template>

<template name="taskRow-index">
  {{index}}
</template>

<template name="taskRow-attempt">
  {{attempt}}
</template>

<template name="taskRow-status">
  {{status this}}
</template>

<template name="taskRow-localityLevel">
  {{locality}}
</template>

<template name="taskRow-execId">
  {{execId}}
</template>

<template name="taskRow-gcTime">
  {{#if metrics.JVMGCTime}}{{formatTime metrics.JVMGCTime}}{{/if}}
</template>

<template name="taskRow-errors">
  {{>fetchFailure end}}
  {{>exceptionFailure end}}
  {{>executorLostFailure end}}
</template>

<template name="fetchFailure">
  {{#if fetchFailure reason}}
    Fetch Failed, {{>hostPort BlockManagerAddress}}: {{message}}<br/>
    Shuffle ID: {{ShuffleID}}<br/>
    Map ID: {{MapID}}<br/>
    Reduce ID: {{ReduceID}}
  {{/if}}
</template>

<template name="exceptionFailure">
  {{#if exceptionFailure reason}}
    {{ClassName}}: {{Description}}<br/>
    {{FullStackTrace}}
    {{>stackTrace StackTrace}}
  {{/if}}
</template>

<template name="stackTrace">
  {{#each this}}
    {{DeclaringClass}}.{{MethodName}} ({{FileName}}:{{LineNumber}})
  {{/each}}
</template>

<template name="executorLostFailure">
  {{#if executorLostFailure reason}}
    {{reason}}: {{ExecutorID}} ({{getHostPort ExecutorID}}
  {{/if}}
</template>

