
<template name="stagesTables">
  {{#if numActiveStages}}<div><a href="#active"><strong>Active Stages:</strong></a> {{numActiveStages}}</div>{{/if}}
  {{#if numPendingStages}}<div><a href="#pending"><strong>Pending Stages:</strong></a> {{numPendingStages}}</div>{{/if}}
  {{#if numCompletedStages}}<div><a href="#completed"><strong>Completed Stages:</strong></a> {{numCompletedStages}}</div>{{/if}}
  {{#if numSkippedStages}}<div><a href="#skipped"><strong>Skipped Stages:</strong></a> {{numSkippedStages}}</div>{{/if}}
  {{#if numActiveStages}}
  <h4 id="active">Active Stages ({{numActiveStages}})</h4>
  {{>stagesTable stages=activeStages}}
  {{/if}}
  {{#if numPendingStages}}
  <h4 id="pending">Pending Stages ({{numPendingStages}})</h4>
  {{>stagesTable stages=pendingStages appId=appId}}
  {{/if}}
  {{#if numCompletedStages}}
  <h4 id="completed">Completed Stages ({{numCompletedStages}})</h4>
  {{>stagesTable stages=completedStages appId=appId}}
  {{/if}}
  {{#if numSkippedStages}}
  <h4 id="skipped">Skipped Stages ({{numSkippedStages}})</h4>
  {{>stagesTable stages=skippedStages appId=appId}}
  {{/if}}
</template>

<template name="stagesTable">
  <table class="table table-bordered table-striped table-condensed sortable">
    <thead>
    <tr>
      <th>Stage ID</th>
      <th>Description</th>
      <th>Submitted</th>
      <th>Duration</th>
      <th>Tasks: Suceeded/Total</th>
      <th>Input</th>
      <th>Output</th>
      <th>Shuffle Read</th>
      <th>Shuffle Write</th>
    </tr>
    </thead>
    <tbody>
    {{#each stages}}
      {{>stageRow e=this appId=../appId}}
    {{/each}}
    </tbody>
  </table>
</template>

<template name="stageRow">
  <tr class="{{getClass this}}">
    <td>{{e.stage.id}}</td>
    <td><a href="/a/{{appId}}/stage/{{e.stage.id}}?attempt={{e.attempt.id}}">{{e.stage.name}}</a></td>

    {{#with e.attempt}}
      <td>{{formatDateTime time.start}}</td>
      <td>{{formatDuration time.start time.end}}</td>

      <td>{{> progressBar taskCounts}}</td>

      {{#with metrics}}
        <td>{{formatBytes InputMetrics.BytesRead}}</td>
        <td>{{formatBytes OutputMetrics.BytesWritten}}</td>
        <td>{{shuffleBytesReadStr ShuffleReadMetrics}}</td>
        <td>{{formatBytes ShuffleWriteMetrics.ShuffleBytesWritten}}</td>
      {{/with}}

    {{/with}}
  </tr>
</template>

