
<template name="stagePage">
  {{>navbar}}
  {{setTitle this}}
  {{log this}}
  <div class="container-fluid">
    {{#with stageAttempt}}
      <h3>Details for Stage {{stageId}}, Attempt {{id}}</h3>
      {{#with taskCounts}}
        {{succeeded}}/{{num}} succeeded, {{running}} active, {{orZero failed}} failed.
      {{/with}}
      {{#with metrics}}
        <div><strong>Total time across all tasks:</strong> {{formatTime ExecutorRunTime}}</div>

        {{#with InputMetrics}}
          {{#if BytesRead}}
          <div>
            <strong>Input Size / Records:</strong> {{formatBytes BytesRead}} / {{RecordsRead}} records
          </div>
          {{/if}}
        {{/with}}

        {{#with OutputMetrics}}
          {{#if BytesWritten}}
          <div>
            <strong>Output Size / Records:</strong> {{formatBytes BytesWritten}} / {{RecordsWritten}} records
          </div>
          {{/if}}
        {{/with}}

        {{#with ShuffleReadMetrics}}
          {{#if shuffleBytesRead this}}
          <div>
            <strong>Shuffle read:</strong> {{shuffleBytesReadStr this}} / {{TotalRecordsRead}} records
          </div>
          {{/if}}
        {{/with}}

        {{#with ShuffleWriteMetrics}}
          {{#if ShuffleBytesWritten}}
          <div>
            <strong>Shuffle write:</strong> {{formatBytes ShuffleBytesWritten}} / {{ShuffleRecordsWritten}} records
          </div>
          {{/if}}
        {{/with}}
      {{/with}}

      {{#with getSubscriptionFn "stage-summary-metrics" this}}
        <div>
          {{>React
              component=Table
              name="summaryMetrics"
              title="Summary Metrics"
              columns=statsColumns
              subscriptionFn=this
              collection="SummaryMetrics"
              allowEmptyColumns=true
              hideEmptyRows=true
              hideRowCount=true
              paginate=false
              disableSort=true
              selectRows=true
              class="stats"
          }}
        </div>
      {{/with}}
      {{#with getSubscriptionFn "stage-executors" this}}
        <div>
          {{>React component=Table columns=executorColumns subscriptionFn=this collection="StageExecutors" name="stageExecutors" title="Executors" totalCollection="NumStageExecutors"}}
        </div>
      {{/with}}
      {{#with getSubscriptionFn "stage-tasks" this}}
        <div>
          {{>React component=Table columns=taskColumns subscriptionFn=this collection="TaskAttempts" name="tasks" title="Tasks" total=../taskCounts.num}}
        </div>
      {{/with}}
    {{/with}}
  </div>
</template>


<template name="taskRow-errors">
  {{>fetchFailure end}}
  {{>exceptionFailure end}}
  {{>executorLostFailure end}}
</template>

<template name="fetchFailure">
  {{#if fetchFailure reason}}
    Fetch Failed, {{>hostPort BlockManagerAddress}}: {{message}}<br/>
    Shuffle ID: {{ShuffleID}}<br/>
    Map ID: {{MapID}}<br/>
    Reduce ID: {{ReduceID}}
  {{/if}}
</template>

<template name="exceptionFailure">
  {{#if exceptionFailure reason}}
    {{ClassName}}: {{Description}}<br/>
    {{FullStackTrace}}
    {{>stackTrace StackTrace}}
  {{/if}}
</template>

<template name="stackTrace">
  {{#each this}}
    {{DeclaringClass}}.{{MethodName}} ({{FileName}}:{{LineNumber}})
  {{/each}}
</template>

<template name="executorLostFailure">
  {{#if executorLostFailure reason}}
    {{reason}}: {{ExecutorID}} ({{getHostPort ExecutorID}}
  {{/if}}
</template>

